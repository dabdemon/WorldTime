<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>World Time Settings</title>

		  <link rel="stylesheet" href="./css/bootstrap.min.css">
		  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
		  <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
		  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js" type="text/javascript"></script>
		  <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"></script>
		  <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&signed_in=true&libraries=places&language=en"	></script>

	</head>
	<body onload="initialize()">
	

		<nav class="navbar navbar-default">
		  <div class="container-fluid">
		    <div class="navbar-header">
		      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
		        <span class="icon-bar"></span>
		        <span class="icon-bar"></span>
		        <span class="icon-bar"></span>                        
		      </button>
		      <a class="navbar-brand" href="#">World Time</a>
		    </div>
		    <div class="collapse navbar-collapse" id="myNavbar">
		      <ul class="nav navbar-nav">
		        <li><a href="#">Settings</a></li>
		        <li><a href="./FAQ.html">FAQ</a></li>
		      </ul>
		    </div>
		  </div>
		</nav>

		<div class = "container">
			<div class="jumbotron">
				<h2 class="text-default">Please enter your settings below, then click on the Submit button</h2>
				<h4 class="text-danger"><b>NOTE:</b> Your changes won't be instantly displayed on your pebble. Please kindly wait up to one minute.</h4>
			</div>
		</div>

		<div class = "container">
			 <form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
                <input type="hidden" name="cmd" value="_xclick">
                <input type="hidden" name="business" value="yweather.pebble@gmail.com">
                <input type="hidden" name="lc" value="US">
                <input type="hidden" name="item_name" value="WorldTime">
                <input type="hidden" name="button_subtype" value="services">
                <input type="hidden" name="no_note" value="0">
                <input type="hidden" name="currency_code" value="EUR">
                <input type="hidden" name="tax_rate" value="0.000">
                <input type="hidden" name="shipping" value="0.00">
                <input type="hidden" name="bn" value="PP-BuyNowBF:btn_paynowCC_LG.gif:NonHostedGuest">
                <input type="hidden" name="on0" value="USER ID">
                <input type="hidden" name="os0" id="os0">

                <input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_paynowCC_LG.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!">
                <img alt="" border="0" src="https://www.paypalobjects.com/es_ES/i/scr/pixel.gif" width="1" height="1">
             </form>
		</div>

		<br>

		<form class="form-horizontal">
			<!--Settings body-->
			<div class="container">
				 
			 	<div class="form-group">
			      <label for="UUID" class="col-lg-2 control-label">User ID</label>
			      <div class="col-lg-10">
			        <input type="text" class="form-control" id="UUID">
			      </div>
			    </div>

			    <div class="form-group">
			      <label for="key" class="col-lg-2 control-label">User Key</label>
			      <div class="col-lg-10">
			        <input type="text" class="form-control" id="key">
			      </div>
			    </div>


			    <div class="form-group">
			      <label for="gps_switch" class="col-lg-2 control-label">Use GPS</label>
			      <div class="col-lg-10">
			        <select class="form-control" id="gps_switch">
			          	<option value="false">No</option>
	                    <option value="true">Yes</option>
			        </select>
			         <span class="help-block">Uses your GPS to automatically determine your local position. You must activate your location services and allow Pebble app access to them.</span>
			      </div>
			    </div>

              
				<div data-role="fieldcontain">
                	<legend>Timezones</legend>

				    <div class="form-group">
				      <label for="localpos" class="col-lg-2 control-label">Local City</label>
				      <div class="col-lg-10">
				        <input class="form-control" id="localpos" placeholder="i.e. Madrid" type="text"></input>
				      </div>
				    </div>

				    <div class="form-group">
				      <label for="dualpos" class="col-lg-2 control-label">Remote City 1</label>
				      <div class="col-lg-10">
				        <input type="text" class="form-control" id="dualpos" placeholder="i.e. Mountain View">
				      </div>
				    </div>

				    <div class="form-group">
				      <label for="dualpos2" class="col-lg-2 control-label">Remote City 2</label>
				      <div class="col-lg-10">
				        <input type="text" class="form-control" id="dualpos2" placeholder="i.e. Osaka">
				      </div>
				    </div>

				    <div class="form-group">
				      <label for="dualpos3" class="col-lg-2 control-label">Remote City 3</label>
				      <div class="col-lg-10">
				        <input type="text" class="form-control" id="dualpos3" placeholder="i.e. Buenos Aires">
				      </div>
				    </div>

            	</div>

                <div data-role="fieldcontain">
                    <fieldset data-role="controlgroup" data-type="horizontal">
                        <legend>Weather</legend>

                    <div data-role="content">
                        <label for="lt"></label>
                        <input type="text" name="lt" id="lt" value="" />
                    </div>

	                <div class="form-group">
				      <label for="weather" class="col-lg-2 control-label">Display Weather</label>
				      <div class="col-lg-10">
				        <select class="form-control" id="weather">
				          	<option value="false">No</option>
		                    <option value="true">Yes</option>
				        </select>
				         <span class="help-block">Support the project with at least 1€ to unlock</span>
				      </div>
				    </div>


					 	<div class="form-group">
					      <label class="col-lg-2 control-label">Units</label>
					      <div class="col-lg-10">
					        <div class="radio">
					          <label>
					            <input type="radio" name="units" id="celsius" value="celsius" checked="">
					            Metric (ºC)
					          </label>
					        </div>
					        <div class="radio">
					          <label>
					            <input type="radio" name="units" id="fahrenheit" value="fahrenheit">
					            Imperial (ºF)
					          </label>
					        </div>
					      </div>
					    </div>
                    </fieldset>
                </div>


			</div>
			<br>
			<!-- Submit buttons-->
			<div class='container' align="center">
                <fieldset>
                    <div class='btn btn-danger' type='cancel' id='b-cancel'>Cancel</button></div>
                    <div class='btn btn-success' type='submit' id='b-submit'>Submit</button></div>
                </fieldset>
            </div>
            
             <!-- footer -->
		<div class = "container">
			<div align = "center">
				<h4>Made with <span class="text-danger"><b>&hearts;</b></span> in Spain</h4>
			</div>
		</div>
		
		</form>
		<script type="text/javascript">
		//Google Search API
		function initialize() {
		  // Create the autocomplete object, restricting the search
		  // to geographical location types.
		  localpos = new google.maps.places.Autocomplete(
		      /** @type {HTMLInputElement} */(document.getElementById('localpos')),
		      { types: ['geocode'] });
		  // Create the autocomplete object, restricting the search
		  // to geographical location types.
		  dualpos = new google.maps.places.Autocomplete(
		      /** @type {HTMLInputElement} */(document.getElementById('dualpos')),
		      { types: ['geocode'] });
		  		  // Create the autocomplete object, restricting the search
		  // to geographical location types.
		  dualpos2 = new google.maps.places.Autocomplete(
		      /** @type {HTMLInputElement} */(document.getElementById('dualpos2')),
		      { types: ['geocode'] });
		  		  // Create the autocomplete object, restricting the search
		  // to geographical location types.
		  dualpos3 = new google.maps.places.Autocomplete(
		      /** @type {HTMLInputElement} */(document.getElementById('dualpos3')),
		      { types: ['geocode'] });
		}			
		</script>



<!-- CODE-->
		<script>
            
                function getQueryVariable(variable) {
                    var query = location.search.substring(1);
                    var vars = query.split('&');
                    for (var i = 0; i < vars.length; i++) {
                        var pair = vars[i].split('=');
                        if (pair[0] == variable)
                            return decodeURIComponent(pair[1]);
                    }
                    return "";
                }
                function saveOptions() {
                    var options = {
                        'use_gps': $('#gps_switch').val(),
                        'localpos': $('#localpos').val(),
                        'dualpos': $('#dualpos').val(),
                        'dualpos2': $('#dualpos2').val(),
                        'dualpos3': $('#dualpos3').val(),
                        'units': $('input:radio[name=units]:checked').val(),
                        'UUID': $('#UUID').val(),
                        'lt': $('#lt').val(),
                        'key': $('#key').val(),
                        'weather': $('#weather').val(),
                        'version' : "1.0"
                    }
                    return options;
                }
                $().ready(function() {
                    //Disable the UUID. this is merely informational
                    //$('#UUID').prop('disabled', true);
                    $('#lt').prop('disabled', true);
                    $("#lt").hide();
                    //Disable all the Extra Features to enable them based on LT
                    $('#weather').prop('disabled', true);
                    $('#celsius').prop('disabled', true);
                    $('#fahrenheit').prop('disabled', true);
                   
                    //Enable LT 1 fields
                    if (parseInt(getQueryVariable('lt')) >= 1) {
                        $('#weather').prop('disabled', false);
                        $('#celsius').prop('disabled', false);
                        $('#fahrenheit').prop('disabled', false);
                    }
                  
                    $('#b-cancel').click(function() {
                        document.location = 'pebblejs://close#';
                    });
                    $('#b-submit').click(function() {
                        document.location = 'pebblejs://close#' + encodeURIComponent(JSON.stringify(saveOptions()));
                    });
                    $('#gps_switch').val(getQueryVariable('use_gps')).change();
                    $('#localpos').val(getQueryVariable('localpos'));
                    $('#dualpos').val(getQueryVariable('dualpos'));
                    $('#dualpos2').val(getQueryVariable('dualpos2'));
                    $('#dualpos3').val(getQueryVariable('dualpos3'));
                    if (getQueryVariable('units') == "celsius") {
                        $('input:radio[name=units][value=celsius]').prop('checked', true).trigger("click");
                    } else {
                        $('input:radio[name=units][value=fahrenheit]').prop('checked', true).trigger("click");
                    }
                   
                    $('#UUID').val(getQueryVariable('UUID'));
                    $('#lt').val(getQueryVariable('lt'));
                    $('#key').val(getQueryVariable('key'));
                    $('#weather').val(getQueryVariable('weather')).change();
                    $('#os0').val(getQueryVariable('UUID'));
                    // Disable location field based on GPS toggle
                    $('#localpos').prop('disabled', $('#gps_switch').val() == "true");
                    $('#gps_switch').change(function() {
                        $('#localpos').prop('disabled', $('#gps_switch').val() == "true");
                    });
                });
			
        </script>


	</body>
</html>
